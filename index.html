<!DOCTYPE html>
<html lang="gu">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BYTE COIN — Auto Mining</title>
<link rel="icon" href="coin.png" />
<style>
  :root{
    --bg:#061021; --card:#0f1724; --accent:#f59e0b; --muted:#94a3b8; --glass: rgba(255,255,255,0.03);
    --success:#4caf50; --danger:#ff5252; --info:#2196f3;
  }
  *{box-sizing:border-box}
  body{ margin:0; font-family:Inter, system-ui, Arial; background:linear-gradient(180deg,#061021,#07162a); color:#e6eef8; -webkit-font-smoothing:antialiased;}
  header.appbar{
    display:flex; align-items:center; gap:12px; padding:12px 16px; background:linear-gradient(90deg, rgba(255,255,255,0.02), transparent);
    border-bottom:1px solid rgba(255,255,255,0.02); position:relative;
  }
  .logo{ width:46px; height:46px; border-radius:50%; background:var(--glass); display:flex; align-items:center; justify-content:center; }
  .logo img{ width:34px; height:34px; }
  .title{ font-size:13px; font-weight:600; color:var(--muted); } /* Subtitle smaller */
  .header-meta{ margin-left:auto; text-align:right; font-size:13px; color:var(--muted); }
  .header-meta .pts{ color:var(--accent); font-weight:800; font-size:15px; }

  /* BIG CENTER TITLE (BYTE COIN) */
  .big-title {
    position:absolute; left:50%; transform:translateX(-50%); top:6px;
    font-size:24px; font-weight:900; letter-spacing:4px;
    background:linear-gradient(90deg,#ffd26b,#ff9800,#ff6a00);
    -webkit-background-clip:text; -webkit-text-fill-color:transparent;
    text-transform:uppercase;
    text-shadow:0 6px 18px rgba(255,152,0,0.12), 0 12px 40px rgba(0,0,0,0.6);
  }

  main{ padding:18px; max-width:960px; margin:18px auto 120px; }
  .card{ background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:14px; padding:16px; margin-bottom:14px; border:1px solid rgba(255,255,255,0.03); box-shadow: 0 10px 30px rgba(2,6,23,0.6);}
  .big-coin{ width:160px; height:160px; border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer; transition: transform .12s ease; border:6px solid rgba(255,255,255,0.04); box-shadow: 0 18px 60px rgba(255,160,60,0.05), inset 0 6px 18px rgba(255,255,255,0.02);}
  .big-coin:active{ transform:scale(0.95) rotate(-6deg); }
  .big-coin img{ width:100px; height:100px; user-select:none; -webkit-user-drag:none; }

  .status h2{ margin:4px 0 6px; font-size:18px; }
  .muted{ color:var(--muted); font-size:13px; }

  /* Highlighted Coins (large & bold) */
  #headerCoins {
    font-size:20px; font-weight:900;
    background:linear-gradient(90deg,#ffea9a,#ffd26b,#ffb84d);
    -webkit-background-clip:text; -webkit-text-fill-color:transparent;
    text-shadow:0 6px 18px rgba(255,160,50,0.12);
  }

  .progress-bar{ width:100%; height:12px; background:rgba(255,255,255,0.03); border-radius:999px; overflow:hidden; margin-top:10px; }
  .progress-fill{ height:100%; width:0%; background:linear-gradient(90deg,var(--accent),#ffd26b); transition:width .3s ease; }

  .controls{ display:flex; gap:8px; margin-top:12px; flex-wrap:wrap; }
  .btn{ padding:8px 12px; border-radius:10px; border:0; cursor:pointer; font-weight:700; background:rgba(255,255,255,0.03); color:#fff; }
  .btn.primary{ background:linear-gradient(90deg,var(--accent),#ffb84d); color:#07121b; }
  .btn.ghost{ background:transparent; border:1px solid rgba(255,255,255,0.03); color:var(--muted); }

  footer.appfooter{ position:fixed; left:0; right:0; bottom:0; display:flex; justify-content:space-around; background:linear-gradient(180deg, rgba(2,6,23,0.7), rgba(2,6,23,0.9)); padding:10px 6px; border-top:1px solid rgba(255,255,255,0.02); backdrop-filter: blur(6px);}
  footer.appfooter button{ background:none; border:none; color:var(--muted); font-weight:700; cursor:pointer; }
  footer.appfooter button.active{ color:var(--accent); }

  input.small{ width:100%; padding:10px; border-radius:8px; background:transparent; border:1px solid rgba(255,255,255,0.03); color:#e6eef8; }

  .share-row{ display:flex; gap:8px; margin-top:10px; flex-wrap:wrap; }
  .join-btn{ padding:10px 14px; border-radius:10px; background:#1976d2; color:#fff; border:0; font-weight:800; cursor:pointer; }

  .history-item{ padding:8px 0; border-bottom:1px dashed rgba(255,255,255,0.03); font-size:13px; display:flex; justify-content:space-between; gap:8px; align-items:center;}
  .history-item .left{max-width:78%}
  .badge { font-weight:800; padding:6px 8px; border-radius:999px; font-size:12px; }
  .badge.mined{ background: rgba(76,175,80,0.12); color:var(--success) }
  .badge.withdraw{ background: rgba(255,82,82,0.08); color:var(--danger) }
  .badge.ref{ background: rgba(245,158,11,0.08); color:var(--accent) }
  .badge.info{ background: rgba(33,150,243,0.08); color:var(--info) }

  /* Toast */
  #toastWrap{ position:fixed; right:18px; bottom:84px; z-index:9999; display:flex; flex-direction:column; gap:8px; align-items:flex-end; max-width:320px; }
  .toast { padding:10px 14px; border-radius:10px; background:rgba(20,24,32,0.95); color:#fff; box-shadow:0 6px 24px rgba(0,0,0,0.5); border:1px solid rgba(255,255,255,0.03); font-weight:700; }
  .toast.success{ border-left:4px solid var(--success) }
  .toast.info{ border-left:4px solid var(--info) }
  .toast.warn{ border-left:4px solid var(--accent) }
  .toast.error{ border-left:4px solid var(--danger) }

  /* Glow pulse */
  .pulse { animation: pulseAnim 0.6s ease; }
  @keyframes pulseAnim { 0% { transform: scale(1); } 50% { transform: scale(1.12);} 100% { transform: scale(1);} }

  @media (max-width:520px){
    .big-coin{ width:130px; height:130px } 
    .big-coin img{ width:80px;height:80px } 
    .big-title{font-size:18px; top:8px} 
    #headerCoins{font-size:18px}
    #toastWrap{ left:12px; right:auto; align-items:flex-start;}
  }
</style>
</head>
<body>

<header class="appbar">
  <div class="logo"><img src="coin.png" alt="bytecoin" /></div>
  <div style="display:flex;flex-direction:column;">
    <div class="title">Auto Mining</div>
  </div>
  <div class="big-title">BYTE COIN</div>
  <div class="header-meta">
    <div>Points: <span id="headerPoints" class="pts">0</span> pts</div>
    <div>Coins: <span id="headerCoins">0</span> ₿</div>
  </div>
</header>

<main>
  <!-- HOME -->
  <section id="page-home" class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;">
      <div>
        <div class="muted">Total Supply</div>
        <div style="font-weight:800;font-size:18px">22,000,000 ₿</div>
      </div>
      <div style="text-align:right">
        <div class="muted">Referral reward (both)</div>
        <div style="font-weight:800;font-size:18px">+100 ₿ each</div>
      </div>
    </div>

    <div class="mine-row" style="margin-top:14px; display:flex; gap:16px; flex-wrap:wrap; align-items:center;">
      <div class="big-coin center" id="bigCoinBtn" title="Tap to get +1 point">
        <img src="coin.png" alt="coin">
      </div>

      <div style="flex:1; min-width:240px;">
        <div class="status">
          <h2>Auto Mining: <span id="mineState">Stopped</span></h2>
          <div class="muted">Speed: <b id="mineSpeed">1 min/point</b> • Next point in <span id="nextTick">--:--</span></div>
        </div>

        <div style="margin-top:10px;">
          <div style="display:flex;justify-content:space-between;font-size:13px;">
            <div class="muted">Points: <b id="pointsDisplay">0</b> / 100</div>
            <div class="muted">Coins: <b id="coinsDisplay">0</b></div>
          </div>
          <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
        </div>

        <div class="controls">
          <button class="btn primary" id="toggleMine">Start Auto-Mining</button>
          <button class="btn ghost" id="instantTap">Instant +1</button>
          <button class="btn" id="settingsBtn">Options</button>
        </div>
        <div class="small-note">Tip: Continuous mining works when the tab/app is open. Offline catch-up credited on return.</div>
      </div>
    </div>
  </section>

  <!-- REFERRAL -->
  <section id="page-referral" class="card" style="display:none">
    <h3>Referral & Channel</h3>
    <div style="display:flex;gap:12px;flex-wrap:wrap;">
      <div style="flex:1;min-width:240px">
        <div style="font-weight:700">Your Referral Link</div>
        <input id="refInput" class="small" readonly style="margin-top:8px"/>
        <div class="share-row">
          <button class="share-btn tg btn" id="shareTG" style="background:#0088cc;color:#fff">Share to Telegram</button>
          <button class="share-btn wa btn" id="shareWA" style="background:#25D366;color:#07121b">Share to WhatsApp</button>
          <button class="btn" id="copyRef">Copy</button>
        </div>
        <div class="small-note">When a new user opens your referral link they receive +100 ₿ immediately and a claim-code is generated for referrer.</div>
      </div>

      <div style="flex:1;min-width:240px">
        <div style="font-weight:700">Join Channel</div>
        <div class="small-note">Click join and you'll receive <b>+500 ₿</b>. (In real app: server-side verification recommended.)</div>
        <div style="margin-top:10px;">
          <a id="channelLink" class="join-btn" href="https://t.me/bytecoinS22m" target="_blank">Join Channel</a>
          <div style="margin-top:8px"><button class="btn" id="claimChannelBtn">Claim Channel Bonus</button></div>
        </div>

        <div style="margin-top:16px;">
          <div style="font-weight:700">Redeem Claim Code</div>
          <input id="redeemCodeInput" class="small" placeholder="Paste claim code here" style="margin-top:8px"/>
          <div style="margin-top:8px"><button class="btn primary" id="redeemBtn">Redeem +100 ₿</button></div>
        </div>
      </div>
    </div>
  </section>

  <!-- WALLET -->
  <section id="page-wallet" class="card" style="display:none">
    <h3>Wallet</h3>
    <div style="display:flex;gap:12px;flex-wrap:wrap;">
      <div style="flex:1;min-width:180px;">
        <div class="muted">Total Coins</div>
        <div style="font-weight:900;font-size:22px" id="walletCoins">0</div>
      </div>
      <div style="flex:1;min-width:180px;">
        <div class="muted">Total Points</div>
        <div style="font-weight:800;font-size:20px" id="walletPoints">0</div>
      </div>
    </div>

    <!-- Withdraw section -->
    <div class="card" style="margin-top:14px;">
      <h4>Withdraw Coins</h4>
      <div class="muted">અહીંથી તમારા ByteCoin (સ્થાનીય ડેમો) withdraw કરો</div>
      <div class="withdraw-row" style="margin-top:10px; display:flex; gap:8px; align-items:center;">
        <input id="withdrawAmount" class="small" type="number" min="1" placeholder="Amount (₿)" />
        <input id="withdrawTo" class="small" type="text" placeholder="Recipient User ID" />
      </div>
      <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
        <button class="btn primary" id="withdrawBtn">Withdraw</button>
        <button class="btn" id="withdrawDemoBtn">Demo Withdraw (show)</button>
      </div>
      <div class="small-note">Note: This is a local/demo withdraw — real transfers need a backend & blockchain.</div>
    </div>

    <h4 style="margin-top:12px">History</h4>
    <div id="historyBox" style="max-height:260px; overflow:auto; margin-top:6px"></div>
  </section>

  <!-- PROFILE -->
  <section id="page-profile" class="card" style="display:none">
    <h3>Profile</h3>
    <div style="display:flex;gap:12px;flex-wrap:wrap;">
      <div style="flex:1;min-width:180px;">
        <div class="muted">Telegram ID</div>
        <div id="profileTelegram" style="font-weight:800">—</div>
      </div>
      <div style="flex:1;min-width:180px;">
        <div class="muted">User ID</div>
        <div id="profileUser" style="font-weight:800">—</div>
      </div>
    </div>

    <div style="margin-top:12px" class="muted">
      <div style="font-weight:700">Mining details</div>
      <ul style="margin-top:8px">
        <li>1 minute = 1 point (Auto-Mining when ON)</li>
        <li>100 points = 1 ByteCoin (auto-convert)</li>
        <li>Referral: referee +100 instantly; referrer redeems via claim code or one-tap claim link</li>
        <li>Channel join click → +500 ByteCoin (click-based credit)</li>
      </ul>
    </div>
  </section>
</main>

<footer class="appfooter">
  <button id="menuHome" class="active">Home</button>
  <button id="menuReferral">Referral</button>
  <button id="menuWallet">Wallet</button>
  <button id="menuProfile">Profile</button>
</footer>

<!-- Toast container -->
<div id="toastWrap" aria-live="polite" aria-atomic="true"></div>

<script>
/* ------------------------
  Keys & init
-------------------------*/
const KEY = {
  uid: 'bc_userId',
  tg: 'bc_tgId',
  pts: 'bc_points',
  cns: 'bc_coins',
  hist: 'bc_history',
  refUsed: 'bc_refUsed',
  outgoingClaim: 'bc_outClaim',
  claimedCodes: 'bc_claimedCodes',
  channelBonus: 'bc_channelBonus',
  minerOn: 'bc_minerOn'
};

function now(){ return new Date().toLocaleString(); }
function randCode(){ return 'BC' + Math.random().toString(36).slice(2,9).toUpperCase(); }

/* --- Toast helper --- */
const toastWrap = document.getElementById('toastWrap');
function showToast(msg, type='info', ttl=3500){
  const t = document.createElement('div');
  t.className = 'toast ' + (type || 'info');
  t.innerText = msg;
  toastWrap.appendChild(t);
  setTimeout(()=> { t.classList.add('fade'); }, 20);
  setTimeout(()=> { t.style.opacity='0'; t.style.transform='translateY(8px)'; }, ttl);
  setTimeout(()=> { try{ toastWrap.removeChild(t); }catch(e){} }, ttl+500);
}

/* --- Pulse Animation Helper --- */
function pulse(el){
  if(!el) return;
  el.classList.add('pulse');
  setTimeout(()=> el.classList.remove('pulse'), 600);
}

/* user */
let userId = localStorage.getItem(KEY.uid);
if(!userId){ userId = 'user_' + Math.floor(Math.random()*900000+100000); localStorage.setItem(KEY.uid, userId); }
document.getElementById('profileUser').innerText = userId;

/* optional telegram id from query */
const params = new URLSearchParams(window.location.search);
const tgParam = params.get('tg_id') || params.get('tgid') || params.get('telegram_id') || null;
if(tgParam) localStorage.setItem(KEY.tg, tgParam);
const tgId = localStorage.getItem(KEY.tg) || '—';
document.getElementById('profileTelegram').innerText = tgId;

/* points/coins/history */
let points = parseInt(localStorage.getItem(KEY.pts) || '0',10);
let coins = parseInt(localStorage.getItem(KEY.cns) || '0',10);
let history = JSON.parse(localStorage.getItem(KEY.hist) || '[]');
let claimedCodes = JSON.parse(localStorage.getItem(KEY.claimedCodes) || '[]');

/* ui refs */
const headerPoints = document.getElementById('headerPoints');
const headerCoins = document.getElementById('headerCoins');
const pointsDisplay = document.getElementById('pointsDisplay');
const coinsDisplay = document.getElementById('coinsDisplay');
const walletPoints = document.getElementById('walletPoints');
const walletCoins = document.getElementById('walletCoins');
const progressFill = document.getElementById('progressFill');
const historyBox = document.getElementById('historyBox');
const refInput = document.getElementById('refInput');
const withdrawAmountEl = document.getElementById('withdrawAmount');

/* mining vars */
const POINTS_PER_COIN = 100;
const MS_PER_POINT = 60_000; // 1 min
let minerInterval = null;
let lastTickAt = Date.now();

/* render */
function renderAll(){
  headerPoints.innerText = points;
  headerCoins.innerText = coins;
  pointsDisplay && (pointsDisplay.innerText = points);
  coinsDisplay && (coinsDisplay.innerText = coins);
  walletPoints.innerText = points;
  walletCoins.innerText = coins;
  const percent = Math.min(100, Math.floor((points/POINTS_PER_COIN)*100));
  progressFill && (progressFill.style.width = percent + '%');
  // history
  historyBox.innerHTML = history.slice().reverse().map(h => {
    const cls = h.type ? `badge ${h.type}` : 'badge info';
    // left text and right time+badge
    return `<div class="history-item"><div class="left"><div>${h.msg}</div><div class="muted" style="margin-top:6px">${h.time}</div></div><div class="right"><div class="${cls}">${h.label || h.type || 'info'}</div></div></div>`;
  }).join('');
  // referral input
  refInput && (refInput.value = window.location.origin + window.location.pathname + '?ref=' + userId);
  // withdraw max
  try{
    withdrawAmountEl && withdrawAmountEl.setAttribute('max', String(coins));
  }catch(e){}
}

/* save/load */
function saveAll(){
  localStorage.setItem(KEY.pts, String(points));
  localStorage.setItem(KEY.cns, String(coins));
  localStorage.setItem(KEY.hist, JSON.stringify(history));
  localStorage.setItem(KEY.claimedCodes, JSON.stringify(claimedCodes));
}
function addHistory(msg, type='info', label=''){
  history.push({msg, time: now(), type, label});
  if(history.length>300) history.shift();
  saveAll(); renderAll();
}

/* --- addPoint with animation --- */
function addPoint(n=1, reason=''){
  points += n;
  addHistory(`${reason}`, 'mined', `+${n} pts`);
  // convert
  if(points >= POINTS_PER_COIN){
    const g = Math.floor(points / POINTS_PER_COIN);
    coins += g;
    points = points % POINTS_PER_COIN;
    addHistory(`Converted ${g*POINTS_PER_COIN} pts → ${g} ₿`, 'ref', `${g} ₿`);
    pulse(headerCoins); // coins pulse
  }
  saveAll(); renderAll();
  pulse(headerPoints); // points pulse
}

/* instant tap and big coin */
document.getElementById('instantTap').addEventListener('click', ()=> { addPoint(1, 'Instant tap'); showToast('+1 point (tap)', 'success'); });
document.getElementById('bigCoinBtn').addEventListener('click', ()=> { addPoint(1, 'Tap'); showToast('+1 point (tap)', 'success'); });

/* miner start/stop */
const toggleBtn = document.getElementById('toggleMine');
const mineStateEl = document.getElementById('mineState');
const nextTickEl = document.getElementById('nextTick');
document.getElementById('mineSpeed').innerText = '1 min/point';

function startMiner(){
  if(minerInterval) return;
  minerInterval = setInterval(()=> { addPoint(1, 'Auto-mined'); lastTickAt = Date.now(); }, MS_PER_POINT);
  lastTickAt = Date.now();
  toggleBtn.innerText = 'Stop Auto-Mining';
  mineStateEl.innerText = 'Running';
  localStorage.setItem(KEY.minerOn, '1');
  addHistory('Auto-miner started', 'info', 'miner');
  showToast('Auto-mining started', 'info');
}
function stopMiner(){
  if(!minerInterval) return;
  clearInterval(minerInterval);
  minerInterval = null;
  toggleBtn.innerText = 'Start Auto-Mining';
  mineStateEl.innerText = 'Stopped';
  localStorage.setItem(KEY.minerOn, '0');
  addHistory('Auto-miner stopped', 'info', 'stopped');
  showToast('Auto-mining stopped', 'warn');
}
toggleBtn.addEventListener('click', ()=> { if(minerInterval) stopMiner(); else startMiner(); });

/* tick UI */
setInterval(()=>{
  if(minerInterval){
    const elapsed = Date.now() - lastTickAt;
    const left = Math.max(0, MS_PER_POINT - elapsed);
    const mm = Math.floor(left/60000); const ss = Math.floor((left%60000)/1000);
    nextTickEl.innerText = `${String(mm).padStart(2,'0')}:${String(ss).padStart(2,'0')}`;
  } else nextTickEl.innerText = '--:--';
}, 500);

/* Referral flow (serverless-friendly) */
(function handleIncomingReferralOrClaim(){
  const params = new URLSearchParams(window.location.search);
  const ref = params.get('ref');
  const claim = params.get('claim');

  if(ref && ref !== userId && !localStorage.getItem(KEY.refUsed)){
    // Give referee +100 coins immediately
    coins += 100;
    addHistory(`Referral bonus: +100 ₿ (referee of ${ref})`, 'ref', '+100 ₿');
    // create outgoing claim code for referrer
    const code = randCode();
    const out = { code, from: userId, to: ref, at: new Date().toISOString() };
    localStorage.setItem(KEY.outgoingClaim, JSON.stringify(out));
    localStorage.setItem(KEY.refUsed, JSON.stringify({from:ref, at: new Date().toISOString()}));
    saveAll(); renderAll();
    showToast('Referral applied — you received +100 ₿. Claim code created.', 'success', 5000);
    // append claim box to referral page (if user stays)
    setTimeout(()=> renderOutgoingClaim(), 300);
  }

  // If someone opens with ?claim=CODE we auto-redeem for them
  if(claim){
    tryRedeemCode(claim);
  }
})();

/* render outgoing claim box */
function renderOutgoingClaim(){
  const raw = localStorage.getItem(KEY.outgoingClaim);
  if(!raw) return;
  const o = JSON.parse(raw);
  // build UI element (if not exists)
  if(!document.getElementById('outClaimBox')){
    const box = document.createElement('div');
    box.id = 'outClaimBox';
    box.style.marginTop = '12px';
    box.innerHTML = `<div style="font-weight:700">Your Claim Code</div>
      <div class="muted">Send this code to the person who referred you on Telegram</div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <input id="outClaimInput" class="small" value="${o.code}" readonly/>
        <button class="btn" id="copyOutClaim">Copy</button>
      </div>`;
    document.getElementById('page-referral').appendChild(box);
    document.getElementById('copyOutClaim').addEventListener('click', ()=> {
      navigator.clipboard.writeText(o.code).then(()=> showToast('Claim code copied', 'info')).catch(()=> showToast('Copy failed', 'error'));
    });
  } else {
    document.getElementById('outClaimInput').value = o.code;
  }
}

/* Redeem code for referrer */
function tryRedeemCode(code){
  if(!code) { showToast('Enter a valid claim code', 'error'); return; }
  code = String(code).trim().toUpperCase();
  // prevent reuse
  if(claimedCodes.includes(code)){ showToast('This code is already redeemed', 'warn'); return; }
  // Validate: serverless — we cannot verify remote; we accept and credit.
  coins += 100;
  claimedCodes.push(code);
  addHistory(`Redeemed claim code ${code} → +100 ₿`, 'ref', '+100 ₿');
  saveAll(); renderAll();
  showToast('+100 ₿ credited to your account.', 'success');
}

/* redeem button */
document.getElementById('redeemBtn').addEventListener('click', ()=>{
  const c = document.getElementById('redeemCodeInput').value;
  tryRedeemCode(c);
});

/* copy referral */
document.getElementById('copyRef').addEventListener('click', ()=>{
  navigator.clipboard.writeText(refInput.value).then(()=> showToast('Referral link copied', 'info')).catch(()=> showToast('Copy failed', 'error'));
});

/* share tg / wa */
document.getElementById('shareTG').addEventListener('click', ()=>{
  const text = `Join me on ByteCoin Auto Mining! Use my referral: ${refInput.value} — get +100 ₿ instantly.`;
  const url = `https://t.me/share/url?url=${encodeURIComponent(refInput.value)}&text=${encodeURIComponent(text)}`;
  window.open(url, '_blank');
});
document.getElementById('shareWA').addEventListener('click', ()=>{
  const text = `Join me on ByteCoin Auto Mining! Use my referral: ${refInput.value} — get +100 ₿ instantly.`;
  const url = `https://wa.me/?text=${encodeURIComponent(text)}`;
  window.open(url, '_blank');
});

/* Channel join claim (click-based) */
document.getElementById('claimChannelBtn').addEventListener('click', ()=>{
  if(localStorage.getItem(KEY.channelBonus) === '1'){ showToast('Channel bonus already claimed', 'warn'); return; }
  // click-based credit
  coins += 500;
  localStorage.setItem(KEY.channelBonus, '1');
  addHistory('+500 ByteCoin (Channel Join Bonus)', 'ref', '+500 ₿');
  saveAll(); renderAll();
  showToast('Channel bonus credited: +500 ₿', 'success');
});

/* ------------------------
   WITHDRAW (local/demo)
-------------------------*/
document.getElementById('withdrawBtn').addEventListener('click', ()=>{
  const amtEl = document.getElementById('withdrawAmount');
  const toEl = document.getElementById('withdrawTo');
  const rawAmt = (amtEl.value || '').toString().trim();
  const toId = (toEl.value || '').trim() || 'unknown';
  if(!rawAmt || isNaN(rawAmt) || Number(rawAmt) <= 0){ showToast('Enter a valid amount', 'error'); return; }
  const amt = Math.floor(Number(rawAmt));
  if(amt > coins){ showToast('Insufficient coins', 'error'); return; }
  // subtract and record
  coins -= amt;
  addHistory(`Withdrew ${amt} ₿ to ${toId}`, 'withdraw', `-${amt} ₿`);
  saveAll(); renderAll();
  showToast(`Withdrawn ${amt} ₿ to ${toId} (demo).`, 'success');
  // clear inputs
  amtEl.value = '';
  toEl.value = '';
});

/* demo withdraw button to show sample (no change) */
document.getElementById('withdrawDemoBtn').addEventListener('click', ()=>{
  showToast('Demo withdraw just shows the form — use Withdraw to perform a local demo transfer.', 'info', 3500);
});

/* wallet render on load */
function init(){
  renderAll();
  // show outgoing claim box if exists
  renderOutgoingClaim();
  // restore miner state if saved
  if(localStorage.getItem(KEY.minerOn) === '1') startMiner();
  // catch-up offline mining
  catchUpMining();
  // default show home
  showPage('page-home');
}
window.addEventListener('load', init);

/* simple navigation */
function showPage(id){
  ['page-home','page-referral','page-wallet','page-profile'].forEach(p=>{
    const el = document.getElementById(p);
    if(el) el.style.display = (p === id) ? 'block' : 'none';
  });
  document.querySelectorAll('footer.appfooter button').forEach(b=>b.classList.remove('active'));
  if(id === 'page-home') document.getElementById('menuHome').classList.add('active');
  if(id === 'page-referral') document.getElementById('menuReferral').classList.add('active');
  if(id === 'page-wallet') document.getElementById('menuWallet').classList.add('active');
  if(id === 'page-profile') document.getElementById('menuProfile').classList.add('active');
}
document.getElementById('menuHome').addEventListener('click', ()=> showPage('page-home'));
document.getElementById('menuReferral').addEventListener('click', ()=> showPage('page-referral'));
document.getElementById('menuWallet').addEventListener('click', ()=> showPage('page-wallet'));
document.getElementById('menuProfile').addEventListener('click', ()=> showPage('page-profile'));

/* save on unload + last tick timestamp for offline catch-up */
function catchUpMining(){
  const last = parseInt(localStorage.getItem('bc_lastTick') || '0', 10);
  const minerSaved = localStorage.getItem(KEY.minerOn) === '1';
  if(last > 0 && minerSaved){
    const elapsed = Date.now() - last;
    const gained = Math.floor(elapsed / MS_PER_POINT);
    if(gained > 0){
      addPoint(gained, `Offline catch-up (${gained} pts)`);
      lastTickAt = Date.now();
      showToast(`Offline catch-up: +${gained} pts`, 'info', 4500);
    }
  }
}
window.addEventListener('beforeunload', ()=> {
  localStorage.setItem('bc_lastTick', String(Date.now()));
  localStorage.setItem(KEY.minerOn, minerInterval ? '1' : '0');
});

/* expose for debug */
window.BYTE = { addPoint, startMiner, stopMiner, tryRedeemCode, state: ()=>({points,coins}) };

</script>
</body>
</html>
