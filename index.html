<!DOCTYPE html>
<html lang="gu">
<head>
Â  <script src='//libtl.com/sdk.js' data-zone='9750463' data-sdk='show_9750463'></script>
Â  <meta charset="utf-8" />
Â  <meta name="viewport" content="width=device-width,initial-scale=1" />
Â  <title>Gujarat Recruitment Hub â€” Refer, Spin & Earn</title>

Â  <!-- confetti CDN -->
Â  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

Â  <style>
Â  :root{
Â  Â  --bg:#070707;
Â  Â  --card:#121212;
Â  Â  --primary:#00e6e6;
Â  Â  --accent:#ff6fbf;
Â  Â  --muted:#9aa0a6;
Â  Â  --glass: rgba(255,255,255,0.04);
Â  Â  --success:#00ffcc;
Â  Â  --danger:#ff5252;
Â  }
Â  *{box-sizing:border-box}
Â  html,body{height:100%}
Â  body{
Â  Â  margin:0;
Â  Â  font-family: "Noto Sans Gujarati", "Inter", system-ui, Arial, sans-serif;
Â  Â  background: linear-gradient(180deg,#050506,#0f1112);
Â  Â  color:#e6eef0;
Â  Â  -webkit-font-smoothing:antialiased;
Â  Â  -moz-osx-font-smoothing:grayscale;
Â  }

Â  /* Header */
Â  .header{
Â  Â  position:sticky;top:0;z-index:40;
Â  Â  display:flex;justify-content:space-between;align-items:center;
Â  Â  padding:12px 16px;background:linear-gradient(90deg,var(--primary),#0077ff);
Â  Â  box-shadow:0 6px 24px rgba(0,0,0,0.6);
Â  }
Â  .app-title{font-weight:800;font-size:16px}
Â  .points-pill{
Â  Â  background:linear-gradient(90deg,#ffd54f,#ff9100);color:#111;padding:6px 10px;border-radius:999px;font-weight:800;
Â  Â  box-shadow:0 8px 30px rgba(255,144,35,0.12);
Â  Â  display:flex;gap:10px;align-items:center;cursor:pointer
Â  }

Â  /* main layout */
Â  .container{padding:16px;padding-bottom:110px}

Â  /* cards grid */
Â  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:12px}
Â  .card{
Â  Â  background:var(--card);padding:12px;border-radius:12px;text-align:center;cursor:pointer;
Â  Â  box-shadow:0 6px 20px rgba(0,0,0,0.6);transition:transform .18s,box-shadow .18s,background .18s;
Â  Â  border:1px solid rgba(255,255,255,0.02);
Â  }
Â  .card:hover{transform:translateY(-6px) scale(1.02); box-shadow:0 12px 34px rgba(0,230,230,0.06); border-color:rgba(0,230,230,0.06)}
Â  .card .icon{font-size:22px;margin-bottom:8px;color:var(--primary)}

Â  /* refer box */
Â  .refer-box{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03); box-shadow:0 6px 20px rgba(0,0,0,0.6)}
Â  .small{color:var(--muted);font-size:13px}

Â  /* buttons */
Â  .btn{border:none;padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:800}
Â  .btn.primary{background:linear-gradient(90deg,var(--primary),#00a6ff);color:#001;text-shadow:0 1px 0 rgba(255,255,255,0.02);box-shadow:0 8px 24px rgba(0,170,255,0.12)}
Â  .btn.ghost{background:rgba(255,255,255,0.03);color:#e6eef0}
Â  .btn.warn{background:rgba(255,82,82,0.15);color:#ffd3d3;border:1px solid rgba(255,82,82,0.25)}

Â  /* footer nav */
Â  .footer{position:fixed;left:0;right:0;bottom:0;height:82px;background:rgba(2,6,8,0.85);display:flex;align-items:center;justify-content:space-around;border-top:1px solid rgba(255,255,255,0.02);backdrop-filter:blur(8px);z-index:50}
Â  .nav-btn{background:none;border:none;color:var(--muted);font-weight:700;display:flex;flex-direction:column;align-items:center;gap:6px;padding:8px;cursor:pointer}
Â  .nav-btn.active{color:var(--primary);transform:translateY(-2px)}

Â  /* quiz */
Â  .quiz-q{background:var(--card);padding:14px;border-radius:12px;margin-bottom:12px;border:1px solid rgba(255,255,255,0.02)}
Â  .opt{padding:10px;border-radius:10px;margin:8px 0;background:rgba(255,255,255,0.02);cursor:pointer;border:1px solid rgba(255,255,255,0.02)}
Â  .opt.correct{background:rgba(0,255,204,0.12);border-color:rgba(0,255,204,0.25)}
Â  .opt.wrong{background:rgba(255,80,80,0.08);border-color:rgba(255,80,80,0.25)}

Â  /* game */
Â  .game-box{background:var(--card);padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.02);text-align:center}
Â  .coin{width:110px;height:110px;border-radius:50%;background:radial-gradient(circle at 35% 35%, #ffe082, #ffb300 60%, #ff8f00);display:grid;place-items:center;font-size:28px;margin:12px auto;box-shadow:0 8px 28px rgba(255,160,0,0.14);cursor:pointer;user-select:none;transition:transform .06s}

Â  /* toast */
Â  .toast{position:fixed;left:50%;transform:translateX(-50%);top:92px;background:#0b1112;color:#fff;padding:10px 14px;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,0.6);display:none;z-index:200}

Â  /* helper */
Â  .hint{font-size:13px;color:var(--muted);margin-top:8px}
Â  .center{display:flex;align-items:center;justify-content:center}

Â  /* leaderboard */
Â  .leader-row{display:flex;justify-content:space-between;gap:8px;align-items:center;padding:10px;border-bottom:1px solid rgba(255,255,255,0.03)}
Â  .leader-me{background:rgba(0,230,230,0.06)}

Â  /* modal */
Â  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:120}
Â  .modal .box{background:var(--card);border:1px solid rgba(255,255,255,0.06);border-radius:14px;padding:16px;min-width:320px;max-width:94vw;box-shadow:0 10px 40px rgba(0,0,0,0.6)}
Â  .modal .box h3{margin:0 0 8px 0}
Â  .chips{display:flex;gap:8px;flex-wrap:wrap}
Â  .chip{background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.06);padding:4px 8px;border-radius:999px;font-size:12px}
Â  </style>
</head>
<body>

<!-- Header -->
<div class="header">
Â  <div class="app-title">Gujarat Recruitment Hub</div>
Â  <div class="points-pill" title="Open Wallet" onclick="openWallet()">
Â  Â  <div id="pointsAnimated" style="min-width:72px;text-align:center">0 pts</div>
Â  </div>
</div>

<!-- Main -->
<div class="container">

Â  <!-- Recruitment -->
Â  <div id="page-sites" class="page active">
Â  Â  <h3>Recruitment Sites</h3>
Â  Â  <p class="small">Official portals â€” opens inside Telegram if available.</p>
Â  Â  <div class="grid" id="sitesGrid"></div>
Â  </div>

Â  <!-- Mock Test -->
Â  <div id="page-quiz" class="page" style="display:none">
Â  Â  <h3>Mock Test (Sample)</h3>
Â  Â  <div id="quizContainer"></div>
Â  </div>

Â  <!-- Updates + Leaderboard -->
Â  <div id="page-updates" class="page" style="display:none">
Â  Â  <h3>Updates</h3>
Â  Â  <div id="updatesList"></div>
Â  Â  <p class="hint" id="lastSync"></p>

Â  Â  <h3 style="margin-top:18px">ğŸ† Leaderboard (Top 10)</h3>
Â  Â  <div id="leaderboard" class="card" style="padding:0"></div>
Â  </div>

Â  <!-- Refer -->
Â  <div id="page-refer" class="page" style="display:none">
Â  Â  <h3>Refer & Earn</h3>
Â  Â  <div class="refer-box">
Â  Â  Â  <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <div class="small">àª¤àª®àª¾àª°à«‹ Referral Code</div>
Â  Â  Â  Â  Â  <div style="font-weight:900;font-size:20px" id="myRef">--</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div style="text-align:right">
Â  Â  Â  Â  Â  <div class="small">àª¤àª®àª¾àª°àª¾ àªªà«‹àª‡àª¨à«àªŸà«àª¸</div>
Â  Â  Â  Â  Â  <div id="pointsSmall" style="font-weight:900;font-size:18px">0</div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
Â  Â  Â  Â Â 
Â  Â  Â  Â  <button class="btn ghost" onclick="shareWhatsapp()">WhatsApp</button>
Â  Â  Â  Â  <button class="btn ghost" onclick="shareTelegram()">Telegram</button>
Â  Â  <button class="btn ghost" onclick="openLink('https://t.me/gujarat_web')">Telegram Group</button>

Â  Â  Â  </div>

Â  Â  Â  <hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)">

Â  Â  Â  <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
Â  Â  Â  Â  <button class="btn primary" onclick="openChannel()">ğŸ“Œ Join Channel & Earn 1000 pts</button>
Â  Â  Â  Â  <div class="small">Join àªšà«‡àª¨àª²: <a href="https://t.me/granthnirman" target="_blank" style="color:var(--primary)">https://t.me/granthnirman</a></div>
Â  Â  Â  </div>

Â  Â  Â  <p class="hint">àª¨à«‹àª‚àª§: Join àª¥àª¯àª¾ àªªàª›à«€ local browser àª®àª¾àª‚ àªàª•àªµàª¾àª° àªœ 1000 àªªà«‹àª‡àª¨à«àªŸ àª†àªªà«àª¯àª¾ àªœàª¶à«‡. For real cross-device credits, Firebase enabled.</p>
Â  Â  </div>
Â  </div>

Â  <!-- Game -->
Â  <div id="page-game" class="page" style="display:none">
Â  Â  <h3>Tap the Coin (Earn)</h3>
Â  Â  <div class="game-box">
Â  Â  Â  <div id="coin" class="coin">ğŸª™</div>
Â  Â  Â  <div style="display:flex;gap:8px;justify-content:center;margin-top:8px">
Â  Â  Â  Â  <button class="btn primary" onclick="startGame()">Start 15s Round</button>
Â  Â  Â  Â  <button class="btn ghost" onclick="resetGameDaily()">Reset Daily (dev)</button>
Â  Â  Â  </div>
Â  Â  Â  <p class="hint">Daily game limit: <span id="gameEarned">0</span> / <span id="GAME_LIMIT">50</span> pts</p>
Â  Â  Â  <p class="hint">Round time left: <span id="timeLeft">0</span>s</p>
Â  Â  </div>
Â  </div>


Â  <!-- Spin -->
Â  <div id="page-spin" class="page" style="display:none">
Â  Â  <h3>ğŸ¡ Daily Spin</h3>
Â  Â  <div class="card" style="padding:18px">
Â  Â  Â  <div style="display:flex;justify-content:center;align-items:center;gap:16px;flex-wrap:wrap">
Â  Â  Â  Â  <div id="wheel" style="width:180px;height:180px;border-radius:50%;background:conic-gradient(#00e6e6 0 45deg,#7c4dff 45deg 90deg,#ff6fbf 90deg 135deg,#ffd54f 135deg 180deg,#66bb6a 180deg 225deg,#29b6f6 225deg 270deg,#ef5350 270deg 315deg,#ab47bc 315deg 360deg);box-shadow:0 12px 40px rgba(0,0,0,.4);position:relative"></div>
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <div class="chips" style="margin-bottom:10px">
Â  Â  Â  Â  Â  Â  <span class="chip">5 pts</span>
Â  Â  Â  Â  Â  Â  <span class="chip">8 pts</span>
Â  Â  Â  Â  Â  Â  <span class="chip">10 pts</span>
Â  Â  Â  Â  Â  Â  <span class="chip">12 pts</span>
Â  Â  Â  Â  Â  Â  <span class="chip">15 pts</span>
Â  Â  Â  Â  Â  Â  <span class="chip">20 pts</span>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <button id="spinNow" class="btn primary">Spin Now</button>
Â  Â  Â  Â  Â  <button id="resetSpinDev" class="btn ghost" style="margin-left:8px">Reset (dev)</button>
Â  Â  Â  Â  Â  <p class="hint" id="spinHint">You can spin once per day.</p>
Â  Â  Â  Â  Â  <p class="hint">Last spin: <span id="lastSpinTxt">â€”</span></p>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

</div>

<!-- Footer -->
<div class="footer">
Â  <button class="nav-btn active" onclick="goto('page-sites', this)"><div>ğŸ¢</div><div>Sites</div></button>
Â  <button class="nav-btn" onclick="goto('page-quiz', this)"><div>ğŸ“</div><div>Mock</div></button>
Â  <button class="nav-btn" onclick="goto('page-updates', this)"><div>ğŸ””</div><div>Updates</div></button>
Â  <button class="nav-btn" onclick="goto('page-refer', this)"><div>ğŸ¤</div><div>Refer</div></button>
Â  <button class="nav-btn" onclick="goto('page-spin', this)"><div>ğŸ¡</div><div>Spin</div></button>
Â  <button class="nav-btn" onclick="goto('page-game', this)"><div>ğŸ®</div><div>Game</div></button>
</div>

<!-- toast -->
<div id="toast" class="toast"></div>

<!-- Wallet Modal -->
<div id="walletModal" class="modal">
Â  <div class="box">
Â  Â  <h3>ğŸ’³ Wallet Balance</h3>
Â  Â  <div style="display:flex;justify-content:space-between;align-items:center">
Â  Â  Â  <div class="small">Total Points</div>
Â  Â  Â  <div style="font-weight:900" id="walletBalance">0</div>
Â  Â  </div>
Â  Â  <div style="margin-top:10px" class="small">Recent (local) history</div>
Â  Â  <div id="txnList" style="max-height:180px;overflow:auto;margin-top:6px;border-top:1px solid rgba(255,255,255,0.06)"></div>
Â  Â  <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
Â  Â  Â  <button class="btn ghost" onclick="closeWallet()">Close</button>
Â  Â  Â  <button class="btn warn" onclick="clearLocal()">Clear Local</button>
Â  Â  </div>
Â  </div>
</div>

<script>
/* ------------------ CONFIG & KEYS ------------------ */
const KEY_POINTS = 'grh_points_v2';
const KEY_REF = 'grh_ref_v2';
const KEY_JOINED_CHANNEL = 'grh_joined_channel_v2';
const KEY_LAST_LOGIN = 'grh_last_login_v2';
const KEY_GAME_DAY = 'grh_game_day_v2';
const KEY_GAME_EARNED = 'grh_game_earned_v2';
const KEY_LAST_SPIN = 'grh_last_spin_v1';
const KEY_TXN_HISTORY = 'grh_txn_history_v1';

const DAILY_LOGIN_BONUS = 5;
const GAME_DAILY_LIMIT = 50;
const GAME_ROUND_SECONDS = 15;

/* ------------------ HELPERS ------------------ */
const $ = sel => document.querySelector(sel);
function showToast(msg, ms=1600){
Â  const t = $('#toast'); t.textContent = msg; t.style.display='block';
Â  setTimeout(()=> t.style.display='none', ms);
}
function todayKey(){ const d=new Date(); return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`; }
function pushTxn(text){
Â  const arr = JSON.parse(localStorage.getItem(KEY_TXN_HISTORY)||'[]');
Â  arr.unshift({ t: new Date().toISOString(), text });
Â  localStorage.setItem(KEY_TXN_HISTORY, JSON.stringify(arr.slice(0,30)));
}
function renderTxns(){
Â  const box = $('#txnList');
Â  const arr = JSON.parse(localStorage.getItem(KEY_TXN_HISTORY)||'[]');
Â  box.innerHTML = arr.length? arr.map(x=>`<div class="leader-row" style="border:none"><div class="small">${new Date(x.t).toLocaleString()}</div><div>${x.text}</div></div>`).join('') : '<div class="small">No local history</div>';
}

/* ------------------ POINTS (animated) ------------------ */
function getPoints(){ return Number(localStorage.getItem(KEY_POINTS) || 0); }
function setPoints(n){ localStorage.setItem(KEY_POINTS, String(n)); updatePointsDisplay(); }

async function addPoints(n, note){
Â  if(window.FIREBASE_READY && window.currentUserId){
Â  Â  const to = await addPointsFirebase(n);
Â  Â  if(note) pushTxn(`${note} +${n}`);
Â  Â  animatePoints(Number($('#pointsAnimated').dataset.val||0), to);
Â  Â  return to;
Â  } else {
Â  Â  if(note) pushTxn(`${note} +${n}`);
Â  Â  return addPointsLocal(n);
Â  }
}
function addPointsLocal(n){
Â  const from = getPoints();
Â  const to = from + n;
Â  localStorage.setItem(KEY_POINTS, String(to));
Â  animatePoints(from, to);
Â  return to;
}
function animatePoints(from, to){
Â  const el = $('#pointsAnimated');
Â  const small = $('#pointsSmall');
Â  const duration = 600;
Â  const start = performance.now();
Â  function step(now){
Â  Â  const t = Math.min(1, (now - start)/duration);
Â  Â  const val = Math.round(from + (to - from) * (1 - Math.pow(1 - t, 3)));
Â  Â  el.textContent = val + ' pts';
Â  Â  el.dataset.val = val;
Â  Â  if(small) small.textContent = val;
Â  Â  if(t < 1) requestAnimationFrame(step);
Â  }
Â  requestAnimationFrame(step);
}
function updatePointsDisplay(){
Â  const v = getPoints();
Â  $('#pointsAnimated').textContent = v + ' pts';
Â  $('#pointsAnimated').dataset.val = v;
Â  if($('#pointsSmall')) $('#pointsSmall').textContent = v;
}

/* ------------------ NAV ------------------ */
function goto(pageId, btn){
Â  document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
Â  document.getElementById(pageId).style.display = 'block';
Â  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
Â  if(btn) btn.classList.add('active');
}

/* ------------------ SITES ------------------ */
const sites = [
Â  {name:'OJAS', url:'https://ojas.gujarat.gov.in', icon:'ğŸ—‚ï¸'},
Â  {name:'GPRB', url:'https://gprb.gujarat.gov.in', icon:'ğŸ‘®'},
Â  {name:'GSSSB', url:'https://gsssb.gujarat.gov.in', icon:'ğŸ“‹'},
Â  {name:'GPSSB', url:'https://gpssb.gujarat.gov.in', icon:'ğŸ‘³'},
Â  {name:'GPSC', url:'https://gpsc.gujarat.gov.in', icon:'ğŸ›ï¸'},
Â  {name:'GPSC-OJAS', url:'https://gpsc-ojas.gujarat.gov.in', icon:'ğŸ“'}
];
function openLink(url){
Â  if(window.Telegram?.WebApp){ Telegram.WebApp.openLink(url); }
Â  else { window.open(url, '_blank'); }
}
function renderSites(){
Â  const grid = document.getElementById('sitesGrid');
Â  grid.innerHTML = '';
Â  sites.forEach(s=>{
Â  Â  const d = document.createElement('div');
Â  Â  d.className = 'card';
Â  Â  d.innerHTML = `<div class="icon">${s.icon}</div><div style="font-weight:800">${s.name}</div><div class="small" style="margin-top:6px">${s.url.replace(/^https?:\/\//,'')}</div>`;
Â  Â  d.onclick = ()=> openLink(s.url);
Â  Â  grid.appendChild(d);
Â  });
}

/* ------------------ QUIZ ------------------ */
const quiz = [
Â  {q: "àª­àª¾àª°àª¤àª¨àª¾ àªªà«àª°àª¥àª® àªµàª¡àª¾àªªà«àª°àª§àª¾àª¨ àª•à«‹àª£ àª¹àª¤àª¾?", opts:["àª¸àª°àª¦àª¾àª° àªªàªŸà«‡àª²","àª®àª¹àª¾àª¤à«àª®àª¾ àª—àª¾àª‚àª§à«€","àªœàªµàª¾àª¹àª°àª²àª¾àª² àª¨à«‡àª¹àª°à«","àª²àª¾àª² àª¬àª¹àª¾àª¦à«àª° àª¶àª¾àª¸à«àª¤à«àª°à«€"], ans:"àªœàªµàª¾àª¹àª°àª²àª¾àª² àª¨à«‡àª¹àª°à«"},
Â  {q: "àª—à«àªœàª°àª¾àª¤àª¨à«€ àª°àª¾àªœàª§àª¾àª¨à«€ àª•àªˆ àª›à«‡?", opts:["àª…àª®àª¦àª¾àªµàª¾àª¦","àª—àª¾àª‚àª§à«€àª¨àª—àª°","àªµàª¡à«‹àª¦àª°àª¾","àª¸à«àª°àª¤"], ans:"àª—àª¾àª‚àª§à«€àª¨àª—àª°"}
];
function renderQuiz(){
Â  const c = $('#quizContainer'); c.innerHTML='';
Â  quiz.forEach(item=>{
Â  Â  const box = document.createElement('div'); box.className='quiz-q';
Â  Â  const qh = document.createElement('div'); qh.style.fontWeight='800'; qh.style.marginBottom='8px'; qh.textContent = item.q;
Â  Â  box.appendChild(qh);
Â  Â  item.opts.forEach(opt=>{
Â  Â  Â  const o = document.createElement('div'); o.className='opt'; o.textContent = opt;
Â  Â  Â  o.onclick = ()=>{
Â  Â  Â  Â  if(o.dataset.locked) return;
Â  Â  Â  Â  box.querySelectorAll('.opt').forEach(x=> x.dataset.locked = 1);
Â  Â  Â  Â  if(opt === item.ans){ o.classList.add('correct'); addPoints(2, 'Quiz'); showToast('+2 pts'); }
Â  Â  Â  Â  else { o.classList.add('wrong'); }
Â  Â  Â  };
Â  Â  Â  box.appendChild(o);
Â  Â  });
Â  Â  c.appendChild(box);
Â  });
}

/* ------------------ UPDATES (demo) ------------------ */
const updates = [
Â  {id:'u1', text:'OJAS: àª¨àªµà«€ àª­àª°àª¤à«€ àªœàª¾àª¹à«‡àª°àª¾àª¤', time:'2025-08-12T10:30:00+05:30'},
Â  {id:'u2', text:'GPRB: Physical test date update', time:'2025-08-13T09:00:00+05:30'}
];
function renderUpdates(){
Â  const ul = $('#updatesList'); ul.innerHTML='';
Â  updates.sort((a,b)=> new Date(b.time)-new Date(a.time)).forEach(u=>{
Â  Â  const c = document.createElement('div'); c.className='card';
Â  Â  c.innerHTML = `<div style="font-weight:800">${u.text}</div><div class="small" style="margin-top:6px">${new Date(u.time).toLocaleString()}</div>`;
Â  Â  ul.appendChild(c);
Â  });
Â  $('#lastSync').textContent = 'Last sync: ' + new Date().toLocaleTimeString();
}

/* ------------------ REFERRAL & SHARE ------------------ */
function ensureRef(){
Â  // Prefer Firebase UID if available
Â  if(window.currentUserId){
Â  Â  $('#myRef').textContent = window.currentUserId;
Â  Â  const link = buildRefLink(window.currentUserId);
Â  Â  $('#myRefLink').textContent = link;
Â  Â  return window.currentUserId;
Â  }
Â  // fallback to local code
Â  let code = localStorage.getItem(KEY_REF);
Â  if(!code){ code = 'GUJ' + Math.random().toString(36).slice(2,7).toUpperCase(); localStorage.setItem(KEY_REF, code); }
Â  $('#myRef').textContent = code;
Â  const link = buildRefLink(code);
Â  $('#myRefLink').textContent = link;
Â  return code;
}
function buildRefLink(code){ return location.origin + location.pathname + '?ref=' + encodeURIComponent(code); }
function copyLink(){ const link = buildRefLink(ensureRef()); navigator.clipboard.writeText(link).then(()=> showToast('Referral link copied')); }
function shareWhatsapp(){ const link = buildRefLink(ensureRef()); const msg = encodeURIComponent(`Gujarat Recruitment Hub â€” Refer & Earn\nJoin: ${link}`); window.open('https://wa.me/?text='+msg, '_blank'); }
function shareTelegram(){ const link = buildRefLink(ensureRef()); const text = encodeURIComponent('Gujarat Recruitment Hub â€” Refer & Earn'); window.open('https://t.me/share/url?url='+encodeURIComponent(link)+'&text='+text, '_blank'); }

// Handle incoming ?ref= (local demo)
(function handleIncomingRefLocal(){
Â  const p = new URLSearchParams(window.location.search);
Â  const incoming = p.get('ref');
Â  if(!incoming) return;
Â  const myCode = localStorage.getItem(KEY_REF);
Â  if(incoming && incoming !== myCode){
Â  Â  const joinKey = 'grh_joined_via_' + incoming;
Â  Â  if(!localStorage.getItem(joinKey)){
Â  Â  Â  addPointsLocal(10); // local joiner bonus if Firebase not ready
Â  Â  Â  localStorage.setItem(joinKey, '1');
Â  Â  Â  pushTxn('Referral join bonus +10');
Â  Â  Â  showToast('Joined via referral â€” +10 pts');
Â  Â  }
Â  }
})();

/* ------------------ Join Channel -> 1000 pts + confetti ------------------ */
function openChannel(){
Â  const url = 'https://t.me/granthnirman';
Â  openLink(url);
Â  const key = KEY_JOINED_CHANNEL;
Â  if(!localStorage.getItem(key)){
Â  Â  addPoints(1000, 'Channel Join');
Â  Â  localStorage.setItem(key, '1');
Â  Â  showToast('+1000 pts â€” Welcome!');
Â  Â  confetti({ particleCount: 160, spread: 120, origin: { y: 0.6 }, colors: ['#ff6fbf','#00e6e6','#ffd54f','#7c4dff','#66bb6a'] });
Â  Â  confetti({ particleCount: 60, spread: 40, origin: { y: 0.35 } });
Â  } else {
Â  Â  showToast('àª¤àª®à«‡ àªªàª¹à«‡àª²à«‡àª¥à«€ àªœ 1000 àªªà«‹àª‡àª¨à«àªŸ àª²àªˆ àªšà«‚àª•à«àª¯àª¾ àª›à«‹');
Â  }
}

/* ------------------ DAILY LOGIN BONUS (local) ------------------ */
(function dailyLogin(){
Â  const today = todayKey();
Â  const last = localStorage.getItem(KEY_LAST_LOGIN);
Â  if(last !== today){
Â  Â  addPoints(DAILY_LOGIN_BONUS, 'Daily Login');
Â  Â  localStorage.setItem(KEY_LAST_LOGIN, today);
Â  Â  showToast(`Daily login +${DAILY_LOGIN_BONUS} pts`);
Â  }
})();

/* ------------------ GAME: Tap the coin ------------------ */
let roundTimer = null;
let roundTimeLeft = 0;
function startGame(){
Â  const today = todayKey();
Â  const storedDay = localStorage.getItem(KEY_GAME_DAY);
Â  if(storedDay !== today){
Â  Â  localStorage.setItem(KEY_GAME_DAY, today);
Â  Â  localStorage.setItem(KEY_GAME_EARNED, '0');
Â  }
Â  const earned = Number(localStorage.getItem(KEY_GAME_EARNED) || 0);
Â  if(earned >= GAME_DAILY_LIMIT){ showToast('Daily game limit reached'); return; }
Â  roundTimeLeft = GAME_ROUND_SECONDS;
Â  $('#timeLeft').textContent = roundTimeLeft;
Â  if(roundTimer) clearInterval(roundTimer);
Â  roundTimer = setInterval(()=>{
Â  Â  roundTimeLeft--;
Â  Â  $('#timeLeft').textContent = roundTimeLeft;
Â  Â  if(roundTimeLeft <= 0){ clearInterval(roundTimer); showToast('Round finished'); }
Â  }, 1000);
}
$('#coin').addEventListener('click', ()=>{
Â  if(roundTimeLeft <= 0){ showToast('Start a round first'); return; }
Â  const today = todayKey();
Â  if(localStorage.getItem(KEY_GAME_DAY) !== today){ localStorage.setItem(KEY_GAME_DAY, today); localStorage.setItem(KEY_GAME_EARNED, '0'); }
Â  let earned = Number(localStorage.getItem(KEY_GAME_EARNED) || 0);
Â  if(earned >= GAME_DAILY_LIMIT){ showToast('Daily game limit reached'); return; }
Â  earned += 1;
Â  localStorage.setItem(KEY_GAME_EARNED, String(earned));
Â  $('#gameEarned').textContent = earned;
Â  addPoints(1, 'Tap Game');
Â  $('#coin').style.transform = 'scale(0.95)';
Â  setTimeout(()=> $('#coin').style.transform = 'scale(1)', 80);
});
function resetGameDaily(){ localStorage.removeItem(KEY_GAME_DAY); localStorage.removeItem(KEY_GAME_EARNED); $('#gameEarned').textContent = '0'; showToast('Daily game reset (dev)'); }

/* ------------------ SPIN: Daily once ------------------ */
function getTodayDateStr(){ return new Date().toDateString(); }
async function doSpin(){
Â  // Check Firebase first
Â  if(window.FIREBASE_READY && window.currentUserId){
Â  Â  const { getFirestore, doc, getDoc, updateDoc, setDoc, increment } = await import('https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js');
Â  Â  const db = window._db;
Â  Â  const uid = window.currentUserId;
Â  Â  const ref = doc(db,'users',uid);
Â  Â  const snap = await getDoc(ref);
Â  Â  if(!snap.exists()) await setDoc(ref,{ points:0, lastSpin:null },{ merge:true });
Â  Â  const data = snap.data()||{};
Â  Â  const today = getTodayDateStr();
Â  Â  if(data.lastSpin === today){ showToast('Already spun today!'); return; }
Â  Â  const pts = Math.floor(Math.random()*16)+5; // 5â€“20
Â  Â  await updateDoc(ref,{ points: increment(pts), lastSpin: today });
Â  Â  localStorage.setItem(KEY_POINTS, String((data.points||0)+pts));
Â  Â  animatePoints(Number($('#pointsAnimated').dataset.val||0), (data.points||0)+pts);
Â  Â  pushTxn(`Spin +${pts}`);
Â  Â  confetti({ particleCount: 160, spread: 120, origin: { y: 0.6 } });
Â  Â  confetti({ particleCount: 60, spread: 40, origin: { y: 0.35 } });
Â  Â  showToast(`ğŸ‰ You won +${pts} pts`);
Â  Â  $('#lastSpinTxt').textContent = today;
Â  Â  return;
Â  }
Â  // Local-only fallback
Â  const today = getTodayDateStr();
Â  const last = localStorage.getItem(KEY_LAST_SPIN);
Â  if(last === today){ showToast('Already spun today!'); return; }
Â  const pts = Math.floor(Math.random()*16)+5;
Â  addPointsLocal(pts);
Â  pushTxn(`Spin +${pts}`);
Â  localStorage.setItem(KEY_LAST_SPIN, today);
Â  $('#lastSpinTxt').textContent = today;
Â  confetti({ particleCount: 160, spread: 120, origin: { y: 0.6 } });
Â  confetti({ particleCount: 60, spread: 40, origin: { y: 0.35 } });
Â  showToast(`ğŸ‰ You won +${pts} pts`);
}

/* ------------------ WALLET MODAL ------------------ */
function openWallet(){
Â  $('#walletModal').style.display='flex';
Â  $('#walletBalance').textContent = getPoints();
Â  renderTxns();
}
function closeWallet(){ $('#walletModal').style.display='none'; }
function clearLocal(){ localStorage.removeItem(KEY_TXN_HISTORY); renderTxns(); }

/* ------------------ INIT ------------------ */
function init(){
Â  renderSites();
Â  renderQuiz();
Â  renderUpdates();
Â  ensureRef();
Â  updatePointsDisplay();
Â  $('#GAME_LIMIT').textContent = GAME_DAILY_LIMIT;
Â  const ge = localStorage.getItem(KEY_GAME_EARNED) || '0';
Â  if($('#gameEarned')) $('#gameEarned').textContent = ge;
Â  $('#spinNow').addEventListener('click', doSpin);
Â  $('#resetSpinDev').addEventListener('click', ()=>{ localStorage.removeItem(KEY_LAST_SPIN); $('#lastSpinTxt').textContent='â€”'; showToast('Spin reset (dev)'); });
Â  const l = localStorage.getItem(KEY_LAST_SPIN); if(l) $('#lastSpinTxt').textContent = l;
}
init();
</script>

<!-- ===================== FIREBASE (Referral + Leaderboard + Spin persistence) ===================== -->
<script type="module">
Â  // ---- Replace with your Firebase config ----
Â  const firebaseConfig = {
Â  Â  apiKey: "AIzaSyDNRTY-dPDXHIzpYPm9OClUr4ucZNmb3tM",
Â  Â  authDomain: "guj-recruit-site.firebaseapp.com",
Â  Â  projectId: "guj-recruit-site",
Â  Â  storageBucket: "guj-recruit-site.firebasestorage.app",
Â  Â  messagingSenderId: "183532061050",
Â  Â  appId: "1:183532061050:web:0c65a374c88f7c8b4116c3",
Â  Â  measurementId: "G-PWDR359Y97"
Â  };

Â  // If config is not filled, skip Firebase and keep local-only mode
Â  const missingConfig = !firebaseConfig.apiKey || firebaseConfig.apiKey === 'YOUR_API_KEY';

Â  if(!missingConfig){
Â  Â  try{
Â  Â  Â  const { initializeApp } = await import('https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js');
Â  Â  Â  const { getAuth, signInAnonymously, onAuthStateChanged } = await import('https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js');
Â  Â  Â  const { getFirestore, doc, setDoc, getDoc, updateDoc, increment, arrayUnion, collection, query, orderBy, limit, getDocs } = await import('https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js');

Â  Â  Â  const app = initializeApp(firebaseConfig);
Â  Â  Â  const auth = getAuth(app);
Â  Â  Â  const db = getFirestore(app);
Â  Â  Â  window._db = db;

Â  Â  Â  window.FIREBASE_READY = true;
Â  Â  Â  window.currentUserId = null;

Â  Â  Â  // helper exposed to earlier script
Â  Â  Â  window.addPointsFirebase = async function(n){
Â  Â  Â  Â  const ref = doc(db, 'users', window.currentUserId);
Â  Â  Â  Â  await setDoc(ref, { points: 0, joinedAt: new Date(), referrals: [], lastSpin: null }, { merge: true });
Â  Â  Â  Â  await updateDoc(ref, { points: increment(n) });
Â  Â  Â  Â  const snap = await getDoc(ref);
Â  Â  Â  Â  const pts = snap.data()?.points || 0;
Â  Â  Â  Â  // mirror local for offline consistency
Â  Â  Â  Â  localStorage.setItem(KEY_POINTS, String(pts));
Â  Â  Â  Â  const small = document.getElementById('pointsSmall');
Â  Â  Â  Â  if(small) small.textContent = pts;
Â  Â  Â  Â  return pts;
Â  Â  Â  }

Â  Â  Â  async function loadLeaderboard(){
Â  Â  Â  Â  const q = query(collection(db,'users'), orderBy('points','desc'), limit(10));
Â  Â  Â  Â  const snap = await getDocs(q);
Â  Â  Â  Â  const uid = window.currentUserId;
Â  Â  Â  Â  let html = '';
Â  Â  Â  Â  let rank = 1;
Â  Â  Â  Â  snap.forEach(docu=>{
Â  Â  Â  Â  Â  const d = docu.data();
Â  Â  Â  Â  Â  const me = (docu.id === uid);
Â  Â  Â  Â  Â  html += `<div class="leader-row ${me?'leader-me':''}"><div>#${rank} ${me?'ğŸ‘¤ You':docu.id.slice(0,6)}</div><div>${d.points||0} pts</div></div>`;
Â  Â  Â  Â  Â  rank++;
Â  Â  Â  Â  });
Â  Â  Â  Â  if(!html) html = '<div class="leader-row"><div>No data yet</div><div>â€”</div></div>';
Â  Â  Â  Â  const lb = document.getElementById('leaderboard');
Â  Â  Â  Â  if(lb) lb.innerHTML = html;
Â  Â  Â  }

Â  Â  Â  function setRefUI(uid){
Â  Â  Â  Â  const link = location.origin + location.pathname + '?ref=' + encodeURIComponent(uid);
Â  Â  Â  Â  const elCode = document.getElementById('myRef');
Â  Â  Â  Â  const elLink = document.getElementById('myRefLink');
Â  Â  Â  Â  if(elCode) elCode.textContent = uid;
Â  Â  Â  Â  if(elLink) elLink.textContent = link;
Â  Â  Â  }

Â  Â  Â  function ensureUserDoc(uid){
Â  Â  Â  Â  return setDoc(doc(db,'users',uid), { points:0, referrals:[], referredBy: null, joinedAt: new Date(), lastSpin: null }, { merge:true });
Â  Â  Â  }

Â  Â  Â  async function handleReferral(uid){
Â  Â  Â  Â  const p = new URLSearchParams(location.search);
Â  Â  Â  Â  const ref = p.get('ref');
Â  Â  Â  Â  if(!ref || ref === uid) return;
Â  Â  Â  Â  // credit only once per referrer for this user
Â  Â  Â  Â  const meRef = doc(db,'users',uid);
Â  Â  Â  Â  const meSnap = await getDoc(meRef);
Â  Â  Â  Â  const already = meSnap.exists() && meSnap.data().referredBy;
Â  Â  Â  Â  if(already) return;
Â  Â  Â  Â  await setDoc(meRef, { referredBy: ref }, { merge:true });
Â  Â  Â  Â  // credit referrer + new user (same as original app)
Â  Â  Â  Â  await updateDoc(doc(db,'users',ref), { points: increment(20), referrals: arrayUnion(uid) });
Â  Â  Â  Â  await updateDoc(meRef, { points: increment(10) });
Â  Â  Â  Â  showToast('Referral applied ğŸ‰ +10 pts');
Â  Â  Â  Â  const snap = await getDoc(meRef);
Â  Â  Â  Â  const pts = snap.data()?.points || 0;
Â  Â  Â  Â  localStorage.setItem(KEY_POINTS, String(pts));
Â  Â  Â  Â  const pa = document.getElementById('pointsAnimated');
Â  Â  Â  Â  if(pa){ pa.textContent = pts + ' pts'; pa.dataset.val = pts; }
Â  Â  Â  Â  const ps = document.getElementById('pointsSmall'); if(ps) ps.textContent = pts;
Â  Â  Â  }

Â  Â  Â  onAuthStateChanged(auth, async (user)=>{
Â  Â  Â  Â  if(user){
Â  Â  Â  Â  Â  window.currentUserId = user.uid;
Â  Â  Â  Â  Â  await ensureUserDoc(user.uid);
Â  Â  Â  Â  Â  setRefUI(user.uid);
Â  Â  Â  Â  Â  // sync points from server into UI/local
Â  Â  Â  Â  Â  const snap = await getDoc(doc(db,'users',user.uid));
Â  Â  Â  Â  Â  const d = snap.data()||{};
Â  Â  Â  Â  Â  const pts = d.points || 0;
Â  Â  Â  Â  Â  localStorage.setItem(KEY_POINTS, String(pts));
Â  Â  Â  Â  Â  const pa = document.getElementById('pointsAnimated');
Â  Â  Â  Â  Â  if(pa){ pa.textContent = pts + ' pts'; pa.dataset.val = pts; }
Â  Â  Â  Â  Â  const ps = document.getElementById('pointsSmall'); if(ps) ps.textContent = pts;
Â  Â  Â  Â  Â  if(d.lastSpin) document.getElementById('lastSpinTxt').textContent = d.lastSpin;
Â  Â  Â  Â  Â  // handle referral if opened with ?ref=
Â  Â  Â  Â  Â  await handleReferral(user.uid);
Â  Â  Â  Â  Â  // load leaderboard
Â  Â  Â  Â  Â  await loadLeaderboard();
Â  Â  Â  Â  }
Â  Â  Â  });

Â  Â  Â  // Start anonymous login (if not already)
Â  Â  Â  signInAnonymously(auth).catch(e=> console.error('Anon sign-in error', e));

Â  Â  }catch(e){
Â  Â  Â  console.warn('Firebase failed to init. Falling back to local-only mode.', e);
Â  Â  Â  window.FIREBASE_READY = false;
Â  Â  }
Â  } else {
Â  Â  window.FIREBASE_READY = false;
Â  }
</script>

</body>
</html>

